---
layout: post
title: File Securer - IRISSCON 2012 Lost Challenges
date: '2013-10-05T16:06:00.000+08:00'
author: Mercurii
tags:
- IRISSCON 2012 Lost Challenges
- WeChall
modified_time: '2013-10-26T12:20:30.535+08:00'
blogger_id: tag:blogger.com,1999:blog-2905258938461604888.post-629212990109781946
blogger_orig_url: http://kectf.blogspot.com/2013/10/file-securer-irisscon-2012-lost.html
---

File Securer - Medium-Hard - 900<br /><div><br /></div><div>A Linux home directory? That certainly is different from the other challenges. A quick glance shows us that 'jackie' downloaded a 'file securer' and probably used it to encrypt a secret message which can be found in the 'Documents' directory.</div><div><blockquote class="tr_bq"><code><br />*********************************************<br />** &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File Securer v0.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;**<br />** &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IRISSCON 2012 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;**<br />*********************************************<br />Usage: ./filesecurer &lt;file&gt;</code></blockquote></div><div>The file securer is an ELF executable, which means we will need IDA for analysis. But firstly, let's try playing around with it. Looking at the readme, using the file securer is as simple as providing a file as an argument when executing it. I gave it the same file twice and the output was exactly the same, so there isn't any randomisation involved which should make this challenge much simpler.<br /><br />Going through the function names in IDA, we can see that the encryption system uses AES 256 bit CBC. Looking at the function&nbsp;aes_init, we could try to reverse the whole process to get the key and iv for the encryption. Hmm, it seems that there is also a debugging process included in the function that prints the key and iv<br /><pre class="prettyprint">result = strcmp(DEBUG, "DEBUG1"); &nbsp;// DEBUG = "DEBUG0"<br />if ( !result )<br />{<br />&nbsp; puts("Testing info only :-)");<br />&nbsp; printf("KEY:\t");<br />&nbsp; for ( i = 0; i &lt;= 31; ++i )<br />&nbsp; &nbsp; printf("%02X", (unsigned __int8)v11[i]);<br />&nbsp; printf("\nIV:\t");<br />&nbsp; for ( i = 0; i &lt;= 15; ++i )<br />&nbsp; &nbsp; printf("%02X", *((_BYTE *)&amp;v7 + i));<br />&nbsp; result = putchar(10);<br />}</pre>Manipulating the executable to print the key and iv for us is much easier than trying to reverse the encryption process. We could patch the executable or we could use GDB to change the value of result while debugging.<br /><br /><u>Patching</u><br />Patching it is as simple as changing the hex values for the jump instruction in assembly.<br /><pre class="prettyprint">.text:08048B6C &nbsp; mov &nbsp;dword ptr [esp+4], offset s2 ; "DEBUG1"<br />.text:08048B74 &nbsp; mov &nbsp;[esp], eax &nbsp;; s1<br />.text:08048B77 &nbsp; call _strcmp<br />.text:08048B7C &nbsp; test eax, eax<br />.text:08048B7E &nbsp; jnz &nbsp;loc_8048C14</pre>JNZ is the original jump instruction which skips printing the key and iv, so we just need to change it to JZ. Click on the jnz instruction in IDA and switch to Hex View-A and we should get the location of the instruction in the executable. Find the hex value for JZ and use a hex editor to change JNZ to JZ.<br /><br /><u>GDB</u><br />Using the address&nbsp;08048B7C found in IDA, we can place a breakpoint at the 'test eax, eax' instruction using GDB. Changing the value of eax should get the executable to print the key and iv<br /><pre class="prettyprint">gdb ./filesecurer<br />b *0x08048B7C<br />run samplefile<br />set $eax = 0<br />cont</pre>Using either method should give us the same result<br /><pre class="prettyprint">Testing info only :-)<br />KEY:<span class="Apple-tab-span" style="white-space: pre;"> 2</span>CCDD45A3E9CF00124492408DFBDBE1FEC97F792E1F5BA43BF2CECF7EB3EC645<br />IV:<span class="Apple-tab-span" style="white-space: pre;"> </span>34E3D91285EE48CD85B82071B93193CB<br />Encrypting file: key<br />File encrypted as: key.enc</pre>Having the key and iv it is now a simple matter of decrypting the secret message found in jackie's home directory.<br /><pre class="prettyprint">openssl enc -aes-256-cbc -in secret_message.txt.enc -out secret_message.txt -K 2CCDD45A3E9CF00124492408DFBDBE1FEC97F792E1F5BA43BF2CECF7EB3EC645 -iv 34E3D91285EE48CD85B82071B93193CB -d</pre><div>900 points!<br /><br /></div><br />Links and Stuff<br /><a href="http://ref.x86asm.net/coder32.html">x86 Opcode and Instruction</a><br /><a href="http://www.openssl.org/docs/apps/enc.html">OpenSSL Enc</a><br /><blockquote class="tr_bq"></blockquote><br /></div>