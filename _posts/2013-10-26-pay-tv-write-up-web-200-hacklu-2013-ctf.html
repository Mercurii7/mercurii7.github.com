---
layout: post
title: Pay TV Write up - Web 200 - Hack.lu 2013 CTF
date: '2013-10-26T12:23:00.000+08:00'
author: Mercurii
tags:
- Write Up
- Hack.lu 2013
- web
modified_time: '2013-10-26T12:23:05.059+08:00'
thumbnail: http://4.bp.blogspot.com/-Qr5sdALt_Ko/Umij7XLmt5I/AAAAAAAABFI/XBgH2n6xGsA/s72-c/2013-10-24+12_36_39-Skynet+Pay+TV.png
blogger_id: tag:blogger.com,1999:blog-2905258938461604888.post-2273869309637746505
blogger_orig_url: http://kectf.blogspot.com/2013/10/pay-tv-write-up-web-200-hacklu-2013-ctf.html
---

<blockquote class="tr_bq">These robo-friends were shocked to see that they had to pay to watch the news broadcast about the “Oktoberfest”. Can you help them?<br />Here is your challenge: https://ctf.fluxfingers.net:1316/</blockquote><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-Qr5sdALt_Ko/Umij7XLmt5I/AAAAAAAABFI/XBgH2n6xGsA/s1600/2013-10-24+12_36_39-Skynet+Pay+TV.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="258" src="http://4.bp.blogspot.com/-Qr5sdALt_Ko/Umij7XLmt5I/AAAAAAAABFI/XBgH2n6xGsA/s400/2013-10-24+12_36_39-Skynet+Pay+TV.png" width="400" /></a></div><div>There isn't much too interesting with the website, inserting a random password gives us the response 'Wrong key'. So let's look at the source to find out more. There is a JavaScript included in the source which posts the password we entered to the server and parses the response received.&nbsp;</div><div><pre class="prettyprint">document.forms[0].addEventListener('submit', function(e) {<br />    var key = document.getElementById('key').value;<br />    var xhr = new XMLHttpRequest();<br />    xhr.open('post', document.forms[0].action);<br />    xhr.addEventListener('load', function() {<br />        data = JSON.parse(xhr.responseText);<br />        if (data['success']) {<br />            document.getElementById('error').style.display = 'none';<br />            document.getElementById('noise').style.display = 'none';<br />            document.getElementById('news').style.display = 'block';<br />            document.getElementById('newstext').innerHTML = data['response'];<br />        } else {<br />            document.getElementById('error').innerHTML = data['response'];<br />        }<br />    });<br />    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');<br />    xhr.send('key=' + encodeURIComponent(key)/* + '&amp;debug'*/)<br />    e.preventDefault();<br />    return false;<br />});<br />document.getElementById('key').focus();</pre>The line of code that interests us is:<br /><pre class="prettyprint">xhr.send('key=' + encodeURIComponent(key)<b>/* + '&amp;debug'*/</b>)</pre><br />The debug parameter is commented out which tells us that it is possible to include it in our post data. There are various tools that can let us modify or include our own post data, such as 'Tamper Data' or 'HttpRequester' both of which are Firefox add-ons. Although only HttpRequester will allow us to view the full server response.<br /><br />The raw HTTP request:<br /><pre class="prettyprint">POST https://ctf.fluxfingers.net:1316/gimmetv<br />Content-Type: application/x-www-form-urlencoded<br />key=a&amp;debug</pre><div class="separator" style="clear: both; text-align: center;"></div>The server resonse:<br /><pre class="prettyprint">{"start": 1382590434.576778, "end": 1382590434.576814, "response": "Wrong key.", "success": false}</pre>Okay, so including 'debug' in the post data gives us start and end, which I assume to be the start and end time for processing our input which is 'key'. So I suspected that the solution would have something to do with the processing time of our input, which is the difference between the end and start time. Now all we need is a brute forcing script that would also record the processing time of each attempt.<br /><br />I created such a script and recorded the results:<br /><pre class="prettyprint">{"a":105,"b":33,"c":49,"d":35,"e":54,"f":32,"g":51,"h":33,"i":41,"j":37,"k":100,"l":56,"m":56,"n":110,"o":197,"p":62,"q":96,"r":70,"s":38,"t":51,"u":48,"v":59,"w":112,"x":56,"y":56,"z":51,"A":100375,"B":5,"C":109,"D":57,"E":54,"F":214,"G":104,"H":66,"I":70,"J":51,"K":36,"L":89,"M":56,"N":93,"O":106,"P":167,"Q":51,"R":62,"S":37,"T":88,"U":39,"V":83,"W":62,"X":134,"Y":35,"Z":72,"0":95,"1":64,"2":120,"3":51,"4":96,"5":49,"6":51,"7":32,"8":52,"9":84,}</pre>If you look closely, you will see that 1 of the timings stand out from the rest! So I expanded the script to repeat the whole process by appending the character with the largest timing and brute forcing the next character until "success": true.<br /><blockquote class="tr_bq"><code> A<br />AX<br />AXM<br />AXMN<br />AXMNP<br />AXMNP9<br />AXMNP93</code></blockquote>Finally, we get the correct password!<br /><pre class="prettyprint">{"start": 1382593774.392999, "end": 1382593775.095665, "response": "OH_THAT_ARTWORK!", "success": true}</pre>Oh, there is 1 thing I forgot to mention. The author provided a hint in the newspaper title in the picture, provided you can read it:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-IjTaG03aiCo/Umi1rp2qR_I/AAAAAAAABFg/2YpX6Sx7qD0/s1600/2013-10-24+13_05_48-Skynet+Pay+TV.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="http://3.bp.blogspot.com/-IjTaG03aiCo/Umi1rp2qR_I/AAAAAAAABFg/2YpX6Sx7qD0/s320/2013-10-24+13_05_48-Skynet+Pay+TV.png" width="320" /></a></div><br /></div>