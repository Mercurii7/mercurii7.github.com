---
layout: post
title: 'InfoSec Institute CTF #2: Level 3'
date: '2015-07-26T14:25:00.000+08:00'
author: Mercurii
tags:
- InfoSecInstitute CTF#2
modified_time: '2015-07-26T14:25:14.019+08:00'
thumbnail: http://1.bp.blogspot.com/-8Lc01wzCLhQ/VbR8ZbHJI4I/AAAAAAAAGSs/_9NgyYqIQjM/s72-c/ex3_intro.png
blogger_id: tag:blogger.com,1999:blog-2905258938461604888.post-5756789187288665538
blogger_orig_url: http://kectf.blogspot.com/2015/07/infosec-institute-ctf-2-level-3.html
---

<div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><em style="box-sizing: border-box;">In the second edition of n00bs CTF Labs, there are 13 small challenges to test your web app hacking skills. The challenges are based on common vulnerabilities (XXS, code injection, inadequate redirect functions etc.) as well as older and less frequently seen vulnerabilities such as Data Validation; Parameter Delimiter.</em></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><em style="box-sizing: border-box;">You can access the CTF by&nbsp;<a href="http://ctf.infosecinstitute.com/ctf2/" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer;">CLICKING HERE</a></em></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><em style="box-sizing: border-box;">This post includes a full walkthrough of how I solved the challenges. If you wish to avoid spoilers, you might want to attempt the challenges yourself before reading on ;).</em></div><hr style="background-color: white; box-sizing: content-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; height: 0px; line-height: 28px;" /><h5 style="-webkit-font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1.25rem; line-height: 28px; margin-bottom: -0.56251rem; margin-top: 0px; padding-top: 0.56251rem;"><a href="https://www.blogger.com/null" id="BEGIN_8" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer; text-decoration: underline;"></a>BEGIN</h5><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">On this level, our task is to create an “admin” account and login with it. We are told that users are stored in a text file using parameter delimiters.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-8Lc01wzCLhQ/VbR8ZbHJI4I/AAAAAAAAGSs/_9NgyYqIQjM/s1600/ex3_intro.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-8Lc01wzCLhQ/VbR8ZbHJI4I/AAAAAAAAGSs/_9NgyYqIQjM/s1600/ex3_intro.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">There’s a great article on attacking with parameter delimiters with examples on OWASP:&nbsp;<a href="https://www.owasp.org/index.php/Parameter_Delimiter" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer;">https://www.owasp.org/index.php/Parameter_Delimiter</a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">That should give you a decent idea on what we are supposed to do for this level.</div><h5 style="-webkit-font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1.25rem; line-height: 28px; margin-bottom: -0.56251rem; margin-top: 0px; padding-top: 0.56251rem;"><a href="https://www.blogger.com/null" id="Walkthrough_17" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer; text-decoration: underline;"></a>Walkthrough</h5><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">Let’s start by registering an account and logging in, just to get an idea of how things work.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-HBs4NIRpxd0/VbR8ZcdV42I/AAAAAAAAGSk/9JpIa1co-0s/s1600/ex3_logged_in.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-HBs4NIRpxd0/VbR8ZcdV42I/AAAAAAAAGSk/9JpIa1co-0s/s1600/ex3_logged_in.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">So I created an account and logged in. The only detail shown is the role of the account. I’m guessing what we need to do is to register an account that will have the role of admin.</div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">role:normal</code>&nbsp;--&gt;&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">role:admin</code></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">Based on the registration page and the logged in page, I’m assuming the details for each account would be stored like so:</div><pre style="background: linear-gradient(rgb(255, 255, 255) 0px, rgb(255, 255, 255) 0.75rem, rgb(245, 247, 250) 0.75rem, rgb(245, 247, 250) 2.75rem, rgb(255, 255, 255) 2.75rem, rgb(255, 255, 255) 4rem) rgb(255, 255, 255); border-radius: 4px; border: 1px solid rgb(211, 218, 234); box-sizing: border-box; color: #333333; font-family: monospace, monospace; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; overflow: auto; padding: 0.66001rem 9.5px 9.5px; word-break: break-all; word-wrap: break-word;"><code class="language-js" style="background-color: transparent; border-radius: 0px; box-sizing: border-box; color: inherit; font-family: monospace, monospace; font-size: inherit; padding: 0px; white-space: pre-wrap;">username:mytest1<br />password:mytest1<br />lastname:mytest1<br />email:mytest1@mytest1<br />role:normal<br /></code></pre><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">To change the account role to admin, let’s try injecting a line break and then&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">role:admin</code>&nbsp;at the email field when registering.</div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">The text input used on the registration form does not support multi-line inputs. There are many ways to get over this restriction. I’m going to list 2 of them.</div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><span style="box-sizing: border-box; font-weight: 700;">Intercepting Proxy</span><br style="box-sizing: border-box;" />You can use an intercepting proxy such as the free version of&nbsp;<a href="https://portswigger.net/burp/" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer;">Burp Suite</a>&nbsp;to modify the request before it is sent to the server. Now, you might wonder how to inject a line break, just add&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">%0D%0A</code>&nbsp;as your line break in the request.&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">%0D</code>&nbsp;is the Carriage Return(CR) character and&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">%0A</code>&nbsp;the Line Feed (LF) character, both are&nbsp;<a href="http://www.w3schools.com/tags/ref_urlencode.asp" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer;">URL encoded</a>. Make sure to URL encode the&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">:</code>&nbsp;character as well</div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">Your email parameter should look like this:&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">email=youremail%40email%0D%0Arole%3Aadmin</code></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><span style="box-sizing: border-box; font-weight: 700;">Developer Tools</span><br style="box-sizing: border-box;" />We could also inject a line break using only the Developer Tools in Google Chrome. Launch Developer Tools and just modfiy the email&nbsp;<a href="http://www.w3schools.com/tags/tag_input.asp" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer;">input tag</a>&nbsp;to a&nbsp;<a href="http://www.w3schools.com/tags/tag_textarea.asp" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer;">textarea tag</a>.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-yOisT3BgoYE/VbR8ZfhaGII/AAAAAAAAGTA/f4HehkHAUPM/s1600/email_textarea.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-yOisT3BgoYE/VbR8ZfhaGII/AAAAAAAAGTA/f4HehkHAUPM/s1600/email_textarea.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">Textareas support multi-line input, just press enter/line break on your keyboard and there you go!</div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-MXSHfod2eq0/VbR8aAP0E1I/AAAAAAAAGTE/A4hNaAwB5qc/s1600/inject_email.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-MXSHfod2eq0/VbR8aAP0E1I/AAAAAAAAGTE/A4hNaAwB5qc/s1600/inject_email.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">Let’s login and check if we have an “admin” account.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-kX3U0mNoLEE/VbR8Zy3xhqI/AAAAAAAAGS4/dZPDzgYViYo/s1600/failed.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-kX3U0mNoLEE/VbR8Zy3xhqI/AAAAAAAAGS4/dZPDzgYViYo/s1600/failed.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">We’re still logged in as a “normal” user. Something was done wrong… Checking the hints will tell us that the assumption of how details are stored is correct, but the injection was done at the wrong parameter. We have to inject the role after the last name, not email.</div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">Let’s try again, this time injecting in the last name field.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-tD5bHWza9kI/VbR8aYQSnEI/AAAAAAAAGTI/A1vf9QsLUcI/s1600/inject_lastname.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-tD5bHWza9kI/VbR8aYQSnEI/AAAAAAAAGTI/A1vf9QsLUcI/s1600/inject_lastname.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">And logging in once again.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-dZXzG-gsTsY/VbR8avctNQI/AAAAAAAAGTM/leW-HziaVlA/s1600/success.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-dZXzG-gsTsY/VbR8avctNQI/AAAAAAAAGTM/leW-HziaVlA/s1600/success.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">We did it! We have an “admin” account!</div><h5 style="-webkit-font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1.25rem; line-height: 28px; margin-bottom: -0.56251rem; margin-top: 0px; padding-top: 0.56251rem;"><a href="https://www.blogger.com/null" id="END_68" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer; text-decoration: underline;"></a>END</h5><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><em style="box-sizing: border-box;">Input validation is critical to your application’s security. Always perform input validation using user’s input in your application.</em></div>